<?xml version="1.0" encoding="Shift_Jis"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="jp" lang="jp"> 
<head> 
	<meta name="author" content="Wink Hosting (www.winkhosting.com)" /> 
	<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS" /> 
	<meta name="keywords" content="RIA,リッチクライアント,Curl,ソフトハウス,プログラマ,SE" /> 
	<meta name="description" content="Curl特集(2)　ドキュメントビューアを作る | 技術情報" /> 
	<meta http-equiv="Content-Style-Type" content="text/css" /> 
	<link rel="stylesheet" href="../images/style.css" type="text/css" /> 
<link href="img/prettify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="img/prettify.js"></script>
<script type="text/javascript" src="img/lang-curl.js"></script>

	<title>Curl特集(2)　ドキュメントビューアを作る | 技術情報</title> 
</head>
<body onload="prettyPrint()" >
	<div id="page" align="center"> 
		<div id="content" style="width:800px"> 
			<div id="logo"> 
				<div style="margin-top:70px" class="whitetitle">IPlanning</div> 
			</div> 
			<div id="topheader"> 
				<div align="left" class="infotext"> 
					<br /> 
					<h1>株式会社 アイプランニング</h1><br /> 
					Towa Edogawabashi building 8F<br /> 
					Yamabuki-cho 347<br /> 
					Shinjuku-ku Tokyo<br /> 
					Phone: 03-5225-1147<br /> 
				</div> 
				<div id="toplinks" class="smallgraytext"> 
					<a href="../index.html">HOME</a> | <a href="../privacy/index.html" target="_blank">個人情報保護方針</a> | <a href="../sitemap.html">サイトマップ</a> | <a href="../contact/index.html">問い合わせ</a> 
				</div> 
			</div> 
			<div id="menu"> 
				<div align="right" class="smallwhitetext" style="padding:9px;"> 
					<a href="../index.html">HOME</a> | <a href="../outline/index.html">会社概要</a> | <a href="../policy/index.html">企業理念</a> | <a href="../product/index.html">開発実績</a> | <a href="../map/index.html">所在地(地図)</a> | <a href="../item/index.html">技術情報</a> 
				</div> 
			</div> 
			<div id="submenu"> 
				<div align="right" class="smallgraytext" style="padding:9px;"> 
					<a href="../about/index.html">代表からの挨拶</a> | <a href="../recruit/new.html">新卒募集</a> | <a href="../recruit/tyuto.html">中途募集</a> | <a href="../voice/index.html">社員の声</a> | <a href="../circle/index.html">サークル活動</a> | <a href="../link/index.html">リンク</a> 
				</div> 
			</div> 
			<div id="contenttext"  align="justify"> 
				<div style="padding:70px 10px 15px 0px"> 
					<span class="titletext"><strong>Curl特集(2)　ドキュメントビューアを作る</strong></span> 
					<p style="padding:8px;font-size:18px;font-weight:bold;text-align:left;line-height:130%;"> 
						RIA環境「Curl」ならではの機能の利用例として、ActiveXの利用、高速なインクリメンタル検索、スクリーンショット防止等の作成方法を公開します。</p> 
				</div> 
<div class="bodytext" style="padding: 12px; align: justify"> 

<p style="margin: 5px 5px 5px 0px;">
Curlの特徴については、前回の記事をご覧ください。<br />
<a href="http://www.ipl.co.jp/item/curl.html">Curl特集(1)「CurlとRubyOnRails連携調査　エンタープライズ向けRIA」</a>
</p>
<img src="img/spacer.gif" width="1" height="40" /><br />

<h2>Curlで作る作成アプリケーションについて</h2>
<p style="margin: 5px 5px 5px 0px;">
下図は、ActiveXを使ったドキュメントビューアの試作です。<br />
弊社でもちょうど社員旅行のシーズンなので、<br />
「社員旅行向けのドキュメントを比較検討する」という設定で作成しました。<br />
<br />
このアプリケーションには、以下のような特徴があります。<br />
・ActiveXにより、PDF, Word, Excelファイルなどを開くことが出来る。<br />
・高速なインクリメンタル検索<br />
・柔軟なレイアウト変更<br />
これらは、RIAの中でもCurlならではといえる機能です。
</p>

<p style="margin: 5px 5px 5px 0px;">
<img src="img/curl_ipl1.png" /><br />
▲ PDF, Word, Excelファイルなどをウィンドウ内で開くことが出来ます。<br />
<img src="img/changelayout.png" width="400" height="334" /><br />
▲ レイアウトを変更することが出来ます。ウィンドウ配置はドラッグで入れ替えます。
</p>
<img src="img/spacer.gif" width="1" height="40" />


<img src="img/spacer.gif" width="1" height="40" />
<h2>開発で作ったコンポーネントなど</h2>

<p style="margin: 5px 5px 5px 0px;">
Curlはオブジェクト指向言語なので、<br />
既存のコンポーネントを継承し拡張すれば<br />
オリジナルの機能を付け加えることが出来ます。
</p>
<p style="margin: 5px 5px 5px 0px;">
以下に、コードの一部を公開します。
</p>

<img src="img/spacer.gif" width="1" height="40" />
<h3>インクリメンタル検索</h3>
<img src="img/incsearch.png" width="373" height="143" style="border: solid 1px #999999; margin: 5px" />
<p style="margin: 5px 5px 5px 0px;">
RecordGridにはフィルタという機能が備わっています。<br />
通常はソートや特定のキーで絞込みを行いますが、<br />
ここでは正規表現でリアルタイムに絞込む機能を実装します。
</p>

<pre class="prettyprint lang-curl"><code>
||絞込み対象RecordGrid
{let grid:RecordGrid =
    {RecordGrid
        ...
        ||ここにデータを定義
    }

{TextField
    height = 0.8cm,
    {on ValueChanged at t:TextField do
        set grid.filter =
            {RecordFilter
                {proc {x:Record}:bool
                    ||filenameカラムを元に絞込み
                    {return {regexp-match? t.value, {String x["filename"]} }}
                }
            }
    }
}
</code></pre>

<img src="img/spacer.gif" width="1" height="40" />
<h3>ActiveXオブジェクト</h3>
<img src="img/activex.png" width="400" height="314" style="border: solid 1px #999999; margin: 5px" />
<p style="margin: 5px 5px 5px 0px;">ActiveXでブラウザ画面を表示し、<br />
Urlでローカルファイルを指定することで、<br />
ブラウザで開けるファイルならなんでも表示できるビューアを作ることが出来ます。
</p>

<p style="margin: 5px 5px 5px 0px;">
注意点としては、Officeファイルを開こうとしたときなどは<br />
セキュリティ警告が発生することがあること、<br />
ウィンドウの制御がCurlと別で行われるので<br />
ActiveXの上から描画を行うことは出来なくなります。
</p>

<pre class="prettyprint lang-curl"><code>
{let ieObject1:ActiveXObject =
	{ActiveXObject
		ProgId = "Shell.Explorer"
	}
}

{ActiveXGraphic
	width={make-elastic preferred-size=1m},
    height={make-elastic preferred-size=1m},
    ieObject1
}
</code></pre>

<img src="img/spacer.gif" width="1" height="40" />
<h3>多機能ウィンドウ</h3>
<img src="img/popup.png" width="409" height="354" style="border: solid 1px #999999; margin: 5px" />
<img src="img/dropframe.png" width="234" height="207" style="border: solid 1px #999999; margin: 5px" />
<p style="margin: 5px 5px 5px 0px;">
（ドラッグ＆ドロップによる配置の入れ替え、別ウィンドウ表示）<br />
タイトルバーを付けたコンテナです。<br />
DropFrameの子にItemFrameを設定して使います。<br />
タイトルバーをドラッグ＆ドロップすることで、<br />
他のItemFrameと位置を交換することが出来ます。
</p>
<pre class="prettyprint lang-curl"><code>
||ドラッグ・ウィンドウ化対応フレーム（子）
||ドラッグ・ウィンドウ化対応フレーム（親）に内包させてください。
{define-class public ItemFrame{inherits VBox}
  {field private _label:Visual = {text-part}}
  {field private _title:String = {String}}
  {field private _contents:Visual}
  {field private _contents-container:Frame = {Frame}}
  {field private _view:View = {View}}
  {constructor public {default title:String="", contents:Visual, ...}
    {construct-super.VBox
        width={make-elastic preferred-size=8cm},
        height={make-elastic preferred-size=8cm},
        dragee={ImageDragee},
        {SkinnableFrame
            ||タイトルバーのスキン
            skin =  {ShadedSkinSpec
                        margin-spec = {OffsetSpec 0pt},
                        "#91BFF2",
                        "#BBE9F0",
                        highlight-alpha-1 = 1,
                        highlight-alpha-2 = 0.4,
                        border-color = "#6C9AF0",
                        corner-radius = 3px,
                        upper-left-rounded? = true,
                        upper-right-rounded? = true,
                        lower-right-rounded? = false,
                        lower-left-rounded? = false||,
                    },
            border-width = 0pt,
            border-style= BorderStyle.none,
            margin = 0pt,
            valign = "center",
            halign = "center",
            width={make-elastic preferred-size=8cm},
            height=0.5cm,
            font-size = 9pt,
            font-weight = "bold",
            ||タイトルバー
            {HBox
                self._label,
                {Fill},
                
                ||ウィンドウ化ボタン
                {CommandButton
                    label = {image source={url "image/fullico.png"}},
                    {on Action at b:CommandButton do
                        ||独立ウィンドウの生成
                        set self._view =
                            {View
                                title = self._title,
                                height = 15cm,
                                width = 15cm,
                                contents,
                                ||独立ウィンドウが閉じられたら、
                                ||Frameを元の場所に戻す
                                {on WindowClose do
                                    {self._contents-container.add
                                        replace? = true,
                                        contents
                                    }
                                    {set b.enabled? = true}
                                }
                            }
                        {self._view.center-view}
                        {self._view.show}
                        {self._contents-container.add
                            replace? = true,
                            {Frame
                                width = {make-elastic},
                                height = {make-elastic},
                                background = "#777777"
                            }
                        }
                        {set b.enabled? = false}
                    }
                }
            },
            color = "#333377"
        },
        self._contents-container,
        {splice ...}
    }
    set self._contents = contents
    {self._contents-container.add contents}
    {self._label.clear}
    {self._label.add title}
    {set self._title = title}
  }

  ||タイトルラベル文字列を変更
  {method public {set-title text:String}:void
    {self._label.clear}
    {self._label.add text}
    {set self._title = text}
    {if (not self._view.destroyed?) then
        {set self._view.title = text}
    }
  }
  
}

||ドラッグ・ウィンドウ化対応フレーム（親）
{define-class public DropFrame{inherits Frame}
  {constructor public {default...}
    {construct-super.Frame
        width={make-elastic preferred-size=8cm},
        height={make-elastic preferred-size=8cm},
        border-width = 1pt,
        border-style= BorderStyle.raised,
        {splice ...},
        {on e:DragOver at f:Frame do 
            {e.will-accept-drop?
                {proc {type:Type, x:Distance, y:Distance,
                       effect:#DragEffect}:DragEffect
                    {if {type.subtype-of? ItemFrame} then
                        {return drag-effect-move}
                     else
                        {return drag-effect-none}
                    }
                }
            }
        },
        {on e:Drop at f:Frame do
            {e.accept-drop
                {proc {a:any, x:Distance, y:Distance,
                       effect:#DragEffect}:DropResult
                    {return
                        {DropResultCopy
                            action =
                                {proc {}:void
                                    let v:#Visual = (a asa #Visual)
                                    let parent:#Visual = v.visual-parent
                                    {for x in f.graphical-children do
                                        {parent.add
                                            x,
                                            replace? = true
                                        }
                                    }
                                    {f.add
                                        a,
                                        replace? = true
                                    }
                                }
                        }
                    }
                }
            }
        }
    }
  }
}
</code></pre>


<img src="img/spacer.gif" width="1" height="40" />
<h2>Tips</h2>
<p style="margin: 5px 5px 5px 0px;">
開発中に知ったテクニックなどを以下に掲載します。
</p>

<img src="img/spacer.gif" width="1" height="40" />
<h3>幅可変レイアウト</h3>
<img src="img/split.png" width="128" height="123" style="border: solid 1px #999999; margin: 5px"/>
<p style="margin: 5px 5px 5px 0px;">
PanedWindowを使えば可変レイアウトが実現できます。
</p>

<pre class="prettyprint lang-curl"><code>
||可変２行ボックス
{define-proc {vpaned-window ...}:PanedWindow
    def pw1 = 
        {PanedWindow
            orientation = Orientation.vertical,
            width={make-elastic preferred-size=10cm},
            height={make-elastic preferred-size=10cm},
            
            {splice ...}
        }

    {for v in ... do
        {pw1.add-pane v}
    }
    {return pw1}
}
</code></pre>

<img src="img/spacer.gif" width="1" height="40" />
<h3>簡易コピー＆ペースト制限（スクリーンキャプチャ防止）</h3>
<p style="margin: 5px 5px 5px 0px;">
情報漏えい対策に、クリップボードを無効化したい場合は、<br />
以下のコードが使えます。
</p>

<pre class="prettyprint lang-curl"><code>
{define-proc public {brockClip}:()
    {let clip:Clipboard = 
        {Clipboard.get-system-clipboard}
    }
    {clip.set-string "コピー・ペーストは禁止しています。"} 
}

{View
    ||ここに隠蔽したい情報を入れる
    ...
    
    {on ViewDeactivateEvent do
        {brockClip}
    }
}
</code></pre>

<p style="margin: 5px 5px 5px 0px;">
これで、Curlウィンドウが非アクティブになったタイミングでクリップボードを上書きします。<br />
スクリーンキャプチャの防止を行いたい場合は、以上の対応に加え、<br />
非アクティブ時にCurlの画面を隠蔽するなどの対応を取らなければならないでしょう。<br />
また、現時点ではActiveXGraphicに対してこの方策は取れないようです。<br />
</p>

<img src="img/spacer.gif" width="1" height="40" />
<h2>まとめ</h2>
<p style="margin: 5px 5px 5px 0px;">
Curlの利点は、このような高機能なUIが、シンプルで小さいコードで実現できるところにあります。<br />
習得は大変でしたが、コードの見通しがよいため、機能追加・修正は素早く行えますし、<br />
慣れればプロトタイプ作成にこぎつけるまではかなり早く行えるようになるでしょう。<br />
</p>

<img src="img/spacer.gif" width="1" height="40" />
</div>
</div>

			<div id="leftpanel"> 
	
				<div align="justify" class="graypanel"> 
					<h3>アイプランニング技術情報</h3> 
					<div class="subtext" style="padding:12px;" align="justify"> 
					このページでは、アイプランニング社員が調査したこと、学んでいることが具体的にどんなものなのかを披露してきます。
					プログラム初心者の方向けの情報から、超マニアックな分野の情報まで随時提供していきますのでお楽しみ下さい。<br /> 
					<br /> 
					<a href="index.html">技術情報TOPページ</a> 
					</div> 
				</div> 
	
				<div align="justify" class="graypanel"> 
					<h3>参考サイト</h3> 
					<div class="subtext" style="padding:12px;" align="justify"> 
					<p><a href="http://www.curlap.com/">公式ページ</a></p>
					<p><a href="http://www.curl-users-group.org/index.php?Curl%20Users%20Group">Curl Users Group</a></p>
					<p><a href="http://developers.curlap.com/home.html">デベロッパー向け公式ページ</a></p>
					<p><a href="http://codezine.jp/article/corner/228">CodeZine:Curl入門記事</a></p>
					<p><a href="http://www.hyuki.com/yukiwiki/wiki.cgi?CURL%bc%c2%b3%ab%c8%af%b9%d6%ba%c2">CurlFAQ</a></p>
					</div> 
				</div> 
	
				<div align="justify" class="graypanel"> 
					<h3>プログラマ募集中・・・</h3> 
					<div class="subtext" style="padding:12px;" align="justify"> 
					<b>■</b><span class="underline">第一は「人物重視」</span><br /> 
					お客さまの立場に立ってモノが作れる判断力、企画力、コンサルティング能力を磨きたくはありませんか？プログラム能力は、プロジェクトを通じて自然と能力があがるようなシステムになっています。初心者プログラマであっても３年程度で、その能力は初心者だったとは思えないくらいのスキルとなっています。<br /> 
					これは、「最初は誰でも初心者だ」という教育方針があるため、また、多くの社員が入社して初めてプログラミングにふれたという経験があるために自分のつまづき体験や、成功体験を含めた教育がなされているからなのです。<br /> 
					このようにアイプランニングでは、社員１人ひとりの個性と人間性を重視し、スキルにあったマンツーマン教育であなたを一人前のエンジニアへと成長させていきます。
					それは誠実なスタッフが集まっているからこそ、どんなお客様からも信頼される企業に成長できるから。私たちはそう考えています。
					</div> 
					<div class="subtext" style="padding:12px;" align="justify"> 
					<b>■</b><span class="underline">応募者へのメッセージ</span><br /> 
					プログラマを目指して会社に入ったものの、思った通りの仕事をさせてもらえなかったと思っている人、教育システムが十分でなかったためにスキルが身に付いていないと思っている人も気軽にご応募ください。パソコンのスキルに自信のない方でも、マンツーマンの研修制度で一人前に成長できるフィールドを整えておりますので安心してご応募くださいね。<br /> 
					知識だけでなく本当の開発力が身につく環境でのシステム開発でみつかる『やりがい』はもちろん、プライベートでも今までになかった充実感が得られますよ。<br /> 
					<ul> 
					<li><a href="../recruit/new.html">⇒新卒応募ページはこちら</a></li> 
					<li><a href="../recruit/tyuto.html">⇒中途応募ページはこちら</a></li> 
					</ul> 
					</div> 
	
				</div> 
			</div> 
	
			<div id="footer" class="smallgraytext"> 
				<a href="../index.html">HOME</a> | <a href="../outline/index.html">会社概要</a> | <a href="../policy/index.html">企業理念</a> | <a href="../product/index.html">開発実績</a> | <a href="../map/index.html">所在地(地図)</a> | <a href="../item/index.html">技術情報</a> 
				| 株式会社 アイプランニング 
				&copy; 1987 
			</div> 
		</div> 
	<script type="text/javascript"> 
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write("\<script src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'>\<\/script>" );
	</script> 
	<script type="text/javascript"> 
	var pageTracker = _gat._getTracker("UA-3244420-1");
	pageTracker._initData();
	pageTracker._trackPageview();
	</script> 
	</div> 
</body>
</html>
