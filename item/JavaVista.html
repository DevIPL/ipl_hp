<?xml version="1.0" encoding="Shift_Jis"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="jp" lang="jp">
<head>
	<meta name="author" content="Wink Hosting (www.winkhosting.com)" />
	<meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS" />
	<meta name="keywords" content="Vista,Windows7,UAC,Java,JavaWebStart,VirtualStore,仮想化,アイプランニング" />
	<meta name="description" content="JavaアプリケーションのWindows7,Vista移行ガイド | 技術情報<" />
	<meta http-equiv="Content-Style-Type" content="text/css" />
	<link rel="stylesheet" href="../images/style.css" type="text/css" />
	<title>JavaアプリケーションのWindows7,Vista移行ガイド | 技術情報</title>
</head>
<body>
	<div id="page" align="center">
		<div id="content" style="width:800px">
			<div id="logo">
				<div style="margin-top:70px" class="whitetitle">IPlanning</div>
			</div>
			<div id="topheader">
				<div align="left" class="infotext">
					<br />
					<h1>株式会社 アイプランニング</h1><br />
					Towa Edogawabashi building 8F<br />
					Yamabuki-cho 347<br />
					Shinjuku-ku Tokyo<br />
					Phone: 03-5225-1147<br />
				</div>
				<div id="toplinks" class="smallgraytext">
					<a href="../index.html">HOME</a> | <a href="../privacy/index.html" target="_blank">個人情報保護方針</a> | <a href="../sitemap.html">サイトマップ</a> | <a href="../contact/index.html">問い合わせ</a>
				</div>
			</div>
			<div id="menu">
				<div align="right" class="smallwhitetext" style="padding:9px;">
					<a href="../index.html">HOME</a> | <a href="../outline/index.html">会社概要</a> | <a href="../policy/index.html">企業理念</a> | <a href="../product/index.html">開発実績</a> | <a href="../map/index.html">所在地(地図)</a> | <a href="../item/index.html">技術情報</a>
				</div>
			</div>
			<div id="submenu">
				<div align="right" class="smallgraytext" style="padding:9px;">
					<a href="../about/index.html">代表からの挨拶</a> | <a href="../recruit/new.html">新卒募集</a> | <a href="../recruit/tyuto.html">中途募集</a> | <a href="../voice/index.html">社員の声</a> | <a href="../circle/index.html">サークル活動</a> | <a href="../link/index.html">リンク</a>
				</div>
			</div>
			<div id="contenttext">
				<div style="padding:70px 10px 15px 0px">
					<span class="titletext"><strong>JavaアプリケーションのWindows7,Vista移行ガイド</strong></span>
					<p style="padding:8px;font-size:18px;font-weight:bold;text-align:left;line-height:130%;">
					VistaやWindows７ではUACにより、セキュリティの向上が図られました。それに伴いファイルシステムなどで仕様変更があり、一部のソフトウェアで互換性が失われています。
					今回は、Vistaでも今までのJavaアプリケーションが問題なく使えるのかどうかを探ってみたいと思います。<br />
					</p>
				</div>

				<h2>§１．UAC（ユーザー・アカウント制御）</h2>
				<div class="bodytext" style="padding:12px;" align="justify">
					<p>WindowsVistaで導入された、管理者権限の必要な操作に対して警告を行いOSを保護する機能。具体的には操作ミスによるシステムファイルの変更や削除、ウイルスによるプログラムの自動インストールなどを実行時に防ぐことができる。<br />
					</p>
					<p>VistaではUACの追加などにより、XPに比べてセキュリティの向上が図られましたが、それに伴いファイルシステムなどで仕様変更がなされ、過去のアプリケーションが正常に動作しない、などのトラブルが起こっています。Javaアプリケーションに関しては、基本的に新しいJREを使っていればVistaでも問題なく動くと考えていいのですが、プログラムの作り方によっては、期待した動作をしないこともありえます。</p>
					<p>
				</div>
				<h2>§２．JavaOnVistaチェックリスト</h2>
				<div class="bodytext" style="padding:12px;" align="justify">
					<p>
					以下の項目に当てはまるJavaアプリケーションは、Vista,Windows7で期待した動作を行えない可能性があります。<br />
					</p>
					<h5 style="margin: 10px 5px 0px 0px;width: 400px;">■Program Files下にファイルを書き込んでいる。</h3>
					<p>　UACにより、ファイルの仮想化が行われます。</p>
					<h5 style="margin: 10px 5px 0px 0px;width: 400px;">■ドライブルートにファイルを書き込んでいる。</h3>
					<p>　ドライブルート（たとえば、c:\直下）にはファイルが書き込めなくなりました。</p>
					<h5 style="margin: 10px 5px 0px 0px;width: 400px;">■使用するJREのバージョンが1.4で、GUIにSwingを使っている。</h3>
					<p>　Swing使用時にVista Basic表示に強制変更されます。</p>
					<h5 style="margin: 10px 5px 0px 0px;width: 400px;">■漢字字体が変更になると困る。（例：人名を扱う）</h3>
					<p>　「巷」「鯖」などの字体が変更になっています。</p>
					<h5 style="margin: 10px 5px 0px 0px;width: 400px;">■第三水準漢字を使う可能性がある。</h3>
					<p>　Vistaで使える漢字のうち、XPでは表示できないものがあります。</p>
				</div>
				<h2>§３．Vista,Windows7移行時のポイント</h2>
				<div class="bodytext" style="padding:12px;" align="justify">
					<h3 style="margin: 10px 5px 5px 0px;width: 400px;">UACについて</h3>
					<p><b>プログラムのデフォルト実行権限が「一般ユーザ」になります。</b><br />
					たとえ管理者でログインしていても、特別な指定をしない限り「一般ユーザ」で実行されます。<br /></p>
					<p style="margin: 5px 5px 5px 0px;">
					<b>「一般ユーザ」は、Program Files, ProgramData, SystemRootなどへのファイルの書き込みが制限されています。</b></p>
					<p style="margin: 5px 5px 5px 0px;">
					Program Files下にプログラム以外の、iniなどの更新を前提とした設定ファイルを置くことは、XP時代から非推奨でしたが、Vistaではセキュリティの強化およびマルチユーザ環境に配慮し、一般ユーザ権限では書き込み自体が行えないようになりました。</p>
					<p style="margin: 5px 5px 5px 0px;">
					しかし、XP時代のプログラムの中には、Program Files下に設定ファイルを置く設定になっているプログラムも多く、そのようなプログラムはVistaでは正常に動作できません。</p>
					<p style="margin: 5px 5px 5px 0px;">
					そのためVistaでは、XPとの互換性確保のため、一般ユーザ権限で<br />
					・Program Files<br />
					・ProgramData<br />
					・SystemRoot<br />
					にファイルを書き込むと、VirtualStoreフォルダ下に「仮想化」が行われます。</p>
					<p style="margin: 5px 5px 5px 0px;">
					例）<br />
					Program Files下にtest.txtを作成したところ、VirtualStore下の仮想化されたProgram Filesにtest.txtが作成される。<br />

					VirtualStore作成された後にファイルアクセスがあった場合、VirtualStore下にリダイレクトされる。<br /><br />
					<img height="321" src="image/m05.png" width="400" alt="Exploer VirtualStore" /> <br />
					</p>
					<p style="margin: 5px 5px 5px 0px;">
					以下は、仮想化が行われているフォルダを表示しています。</p>
					<p style="margin: 5px 5px 5px 0px;">
					<img height="251" src="image/m02.png" width="400" alt="仮想化" /><br />
					仮想化が行われているフォルダでは、<br />
					<img height="29" src="image/m07.png" width="119" alt="互換性ファイル" /><br />
					「互換性ファイル」のアイコンが表示されます。<br />
					このアイコンをクリックすると、リダイレクト先フォルダを参照することができます。</p>
					<p>この仮想化機能により、特定ユーザがProgram Filesに変更を加えても、他のユーザに影響を及ぼすことはなくなります。</p>
					<p style="margin: 5px 5px 5px 0px;">
					XPまではユーザ全体に変更を及ぼしていたProgram Files下のファイル操作が、Vistaではユーザ別にしか変更が起こらないことに注意してください。</p>
					<p><img height="273" src="image/user.png" width="363" alt="ユーザ毎のVirtualStore" /></p>
					<p>
					なお、このVirtualStoreは過去のソフトウェア資産をVistaで動作させるための措置であり、<br />
					今後はProgram Filesにiniなどの更新を前提としたファイルを置くことは推奨されません。<br />
					設定ファイルはユーザのホームディレクトリに保存するようにしましょう。</p>

					<h3 style="margin: 20px 5px 5px 0px;width: 400px;">フォントについて</h3>
					<p>
					XPのクライアントと、Vistaのクライアントが混在するようなシステムでは、文字コードに関係する問題が発生する可能性があります。<br />
					XP時代はCP932をサポートしていましたが、Vistaでは新たにJIS X 0213をサポートします。</p>
					<p style="margin: 5px 5px 5px 0px;">
					変更点としては、字体の訂正と文字の追加です。<br />
					変更・追加のあった文字をVistaクライアントで入力し、XPクライアントで参照するようなときに、いわゆる「文字化け」が発生するおそれがあります。</p>
					<p style="margin: 5px 5px 5px 0px;">
					詳しくはITproの記事を参照してください。<br />
					■ITpro - Vista文字セット問題<br /> 
					<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20080205/293111/?ST=vista">http://itpro.nikkeibp.co.jp/article/COLUMN/20080205/293111/?ST=vista</a><br />
					</p>
					<h3 style="margin: 20px 5px 5px 0px;width: 400px;">古いJREをVistaで動かす際の注意点</h3>
					<p>
					・Swing使用時に、Basic表示に強制変更される古いバージョンのJREを使うと、AeroがオフにされVista Basic表示に強制的に切り替えられることがあります。<br />
					起動時に、Aeroが自動的にオフにされ、ダイアログが表示されます。<br />
					この問題は、新しいバージョンのJREをインストールすることで解決します。</p>
					<p style="margin: 5px 5px 15px 0px;">
					※手持ちの環境がVista Basicのため、この問題は検証できていませんが、少なくとも最新のJRE 5, JRE 6では正常動作しているようです。<br />
					（参考：<a href="http://d.hatena.ne.jp/Kazzz/20061202/p1">KazzzのJとNのはざまで - Java on Vista</a>）</p>
				</div>
				<h2>§３．JavaアプリケーションのVista,Windows7移行 検証編 </h2>
				<div class="bodytext" style="padding:12px;" align="justify">
					<p>以下のような、簡単なSwingアプリケーションを作成し、Java Web Start経由で実行しました。<br />
					※コンパイルした環境はJDK5互換, 実行環境はJRE6です。</p>
					<p style="margin: 5px 5px 5px 0px;">
					左ペインに入力したテキストをファイルに保存し、右ペインで保存したテキストファイルを読み込みます。<br />
					<span class="titletext"><img height="398" src="image/m08.png" width="400" alt="UAC検証Javaサンプル" /></span>
					<br />
					保存・読み込み先は<br />
					"<b><font color="#0080ff">C:/Program Files/Java/jre1.6.0_03/test.txt</font></b>"<br />
					としています。<br />
					<br />
					このディレクトリは、java.homeプロパティに定義されているもの、<br />
					つまりProgram Files下のJREのフォルダです。<br />
					Program Files下に手っ取り早くアクセスさせるためjava.homeに保存しています。</p>
					<p style="margin: 5px 5px 5px 0px;">
					<img height="243" src="image/m06.png" width="400" alt="JavaWebStart認証ダイアログ" /></p>
					<p style="margin: 5px 5px 5px 0px;">
					実行したアプリケーションが、無制限のリソースアクセスを要求していたので<br />
					まずアプリケーションの提供元を信頼するかどうかのダイアログが出ます。<br />
					これはJava 	VMが表示したものです。<br />
					<br />
					もともとXP環境でもこういうダイアログは出ますので、このあたりは、Vistaでも変わっていません。<br />
					<br />
					では、署名を信頼してアプリケーションを実行してみます。</p>
					<p style="margin: 5px 5px 5px 0px;">
					作成したJavaアプリケーションから、<br />
					"<b><font color="#0080ff">C:/Program Files/Java/jre1.6.0_03/test.txt</font></b>"に"this is test"の文字列を保存しました。<br />
					実際にProgram Files下にファイルが保存されているか見に行ってみましょう。</p>
					<p style="margin: 5px 5px 5px 0px;">
					<img height="251" src="image/m02.png" width="400" alt="JRE on Vista ProgramFiles" /><br />
					指定した保存先を開いてみましたが、保存したはずのtest.txtはありませんでした。<br />
					その代わり、</p>
					<p><img height="29" src="image/m07.png" width="119" alt="Vista 互換性ファイル" /></p>
					<p>このような「互換性ファイル」というアイコンが見えます。<br />
					このアイコンをクリックしますと、別のフォルダに移動します。</p>
					<p><img height="251" src="image/m03.png" width="400" alt="Vista ProgramFiles内のファイル" /></p>
					<p><font color="#0080ff"><strong>VirtualStore</strong></font>という見慣れないフォルダ下に移動し、<br />
					そこにtest.txtだけが置かれています。</p>
					<p style="margin: 5px 5px 5px 0px;">
					<img height="342" src="image/m04.png" width="400" alt="Vista ProgramFiles内のファイルはVirtualStoreへ" /></p>
					<p>test.txtを開くと、確かに保存されています。</p>
					<p>&nbsp;</p>
					<p>どこのディレクトリに保存されたのかを詳しく見てみましょう。<br />
					<img height="321" src="image/m05.png" width="400" alt="Vista VirtualStore" /><br />
					今回の場合、<br />
					<b><font color="#0080ff">C:/Program Files/Java/jre1.6.0_03/test.txt</font> 
					</b><br />
					に保存したつもりが、<br /><b><font color="#0080ff">C:/Users/ユーザ名/AppData/VirtualStore/Program Files/Java/jre1.6.0_03/test.txt </font></b><br />に保存されています。</p>
					<p>&nbsp;</p>
					<p style="margin: 5px 5px 5px 0px;">
					Vistaでは、Program Filesへの書き込みを原則として禁じています。<br />
					そのため、iniファイルなどのProgram Filesに置く設定になっている、XP時代の「行儀の悪い」ソフトウェアは動作しなくなってしまいます。<br />
					<br />
					そこで、VistaではProgram Filesへの書き込みを、ユーザフォルダへのリダイレクトという形で解決しています。</p>
					<p><span class="titletext"><img height="433" src="image/virtualstore.png" width="381" alt="Vista ProgrameFiles から VirtualStore" /></span>
					</p>
					<p>&nbsp;</p>
					<p style="margin: 5px 5px 5px 0px;">
					このため、今回テストに用いたアプリケーションを別のアカウントから起動し、test.txtを読み込む動作をすると、「ファイルがない」と怒られます。<br />
					保存したtest.txtは、以前ログインしていたユーザフォルダのVirtualStoreにしかないためです。<br />
					Program Files内のiniを更新しても、ログインユーザのVirtualStoreにしか変更が及ばず、別ユーザでは変更が適用されていないというようなことが起こりえます。</p>
					<p><span class="titletext"><img height="273" alt="Vistaユーザ毎のバーチャルストア"  src="image/user.png" width="363" /></span></p>
					<p style="margin: 5px 5px 5px 0px;">
					たとえば、ゲームのハイスコアといったような、<br />
					全ユーザから参照したい設定ファイルは、<br />
					%allusersprofile%下に保存することが推奨されます。<br />
					参考：<a href="http://msdn2.microsoft.com/ja-jp/magazine/cc163486.aspx">MSDNのVistaUACに関するドキュメント</a></p>
				</div>
				<h2>§４．JavaアプリケーションのVista,Windows7移行 まとめ </h2>
				<div class="bodytext" style="padding:12px;" align="justify">
					<p>VistaでJAVAを使うにあたって、まずJREのバージョンを最新にしておくことが大事と言えるでしょう。<br />
					Vistaに関連した不具合も多くFIXされています。修正内容に関してはリリースノートを参照してください。<br />
					<a href="http://java.sun.com/j2se/1.4.2/ja/ReleaseNotes.html">J2SE1.4.2</a><br />
					<a href="http://java.sun.com/j2se/1.5.0/ja/ReleaseNotes.html">J2SE5.0</a><br />
					<a href="http://java.sun.com/javase/ja/6/webnotes/ReleaseNotes.html">JavaSE6</a><br />
					<br />
					特にトラブルが発生すると考えられるのが、UACによる仮想化です。<br />
					UACを無効にして使う方法もありますが、VistaでのUAC機能は有用な機能なので、できる限り有効にしておきましょう。</p>
					<p style="margin: 5px 5px 5px 0px;">
					ソフトを新規に開発する際においては、<a href="http://msdn2.microsoft.com/ja-jp/magazine/cc163486.aspx">MSDNのVistaUACに関するドキュメント</a>が参考になると思います。</p>
					<p style="margin: 5px 5px 5px 0px;">
					どのタイミングでVistaに移行するかは難しいところかと思われますが、セキュリティを意識させられるという点で、勉強になるOSです。<br />
					個人的にWindowsPC導入を考えられている方は、メモリさえあればVistaにしておくのがいいでしょうね。</p>
				</div>


			</div>

			<div id="leftpanel">

				<div align="justify" class="graypanel">
					<h3>アイプランニング技術情報</h3>
					<div class="subtext" style="padding:12px;" align="justify">
					このページでは、アイプランニング社員が調査したこと、学んでいることが具体的にどんなものなのかを披露してきます。
					プログラム初心者の方向けの情報から、超マニアックな分野の情報まで随時提供していきますのでお楽しみ下さい。<br />
					<br />
					<a href="index.html">技術情報TOPページ</a>
					</div>
				</div>

				<div align="justify" class="graypanel">
					<h3>プログラマ募集中・・・</h3>
					<div class="subtext" style="padding:12px;" align="justify">
					<b>■</b><span class="underline">第一は「人物重視」</span><br />
					お客さまの立場に立ってモノが作れる判断力、企画力、コンサルティング能力を磨きたくはありませんか？プログラム能力は、プロジェクトを通じて自然と能力があがるようなシステムになっています。初心者プログラマであっても３年程度で、その能力は初心者だったとは思えないくらいのスキルとなっています。<br />
					これは、「最初は誰でも初心者だ」という教育方針があるため、また、多くの社員が入社して初めてプログラミングにふれたという経験があるために自分のつまづき体験や、成功体験を含めた教育がなされているからなのです。<br />
					このようにアイプランニングでは、社員１人ひとりの個性と人間性を重視し、スキルにあったマンツーマン教育であなたを一人前のエンジニアへと成長させていきます。
					それは誠実なスタッフが集まっているからこそ、どんなお客様からも信頼される企業に成長できるから。私たちはそう考えています。
					</div>
					<div class="subtext" style="padding:12px;" align="justify">
					<b>■</b><span class="underline">応募者へのメッセージ</span><br />
					プログラマを目指して会社に入ったものの、思った通りの仕事をさせてもらえなかったと思っている人、教育システムが十分でなかったためにスキルが身に付いていないと思っている人も気軽にご応募ください。パソコンのスキルに自信のない方でも、マンツーマンの研修制度で一人前に成長できるフィールドを整えておりますので安心してご応募くださいね。<br />
					知識だけでなく本当の開発力が身につく環境でのシステム開発でみつかる『やりがい』はもちろん、プライベートでも今までになかった充実感が得られますよ。<br />
					<ul>
					<li><a href="../recruit/new.html">⇒新卒応募ページはこちら</a></li>
					<li><a href="../recruit/tyuto.html">⇒中途応募ページはこちら</a></li>
					<ul>
					</div>
				</div>

				<div align="justify" class="graypanel">
					<h3>参考サイト</h3>
					<div class="subtext" style="padding:12px;" align="justify">
					<p><a href="http://www.mki.ne.jp/developers/document/vista/vista-search.html">Developer'sWorks <br /> WindowsVista 調査速報</a></p>
					<br /> 
					<p><a href="http://d.hatena.ne.jp/Kazzz/20061202/p1">KazzzのJとNのはざまで <br /> Java on Vista</a></p>
					<br /> 
					<p><a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20080205/293111/?ST=vista">ITpro <br /> Vista文字セット問題</a></p>
					<br />
					<p><a href="http://dsas.blog.klab.org/archives/51108671.html">DSAS開発者の部屋 <br /> Vista で動くプログラムを書くために〜UAC編〜</a></p>
					<br />
					<p><a href="http://mcn.oops.jp/wiki/index.php?Windows%20Vista%2FSecurity%2FUser%20Account%20Control">SyncHack Windows Vista<br />Security/User Account Control</a></p>
					<br />
					<p><a href="http://www.atmarkit.co.jp/fwin2k/vista_feature/index/">@IT - Vistaの地平</a></p>
					<br />
					<p><a href="http://msdn2.microsoft.com/ja-jp/magazine/cc163486.aspx">msdn <br /> アプリケーションで Windows Vista のユーザー アカウント制御を有効に活用する</a></p>
					</div>
				</div>



			</div>
			<div id="footer" class="smallgraytext">
				<a href="../index.html">HOME</a> | <a href="../outline/index.html">会社概要</a> | <a href="../policy/index.html">企業理念</a> | <a href="../product/index.html">開発実績</a> | <a href="../map/index.html">所在地(地図)</a> | <a href="../item/index.html">技術情報</a>
				| 株式会社 アイプランニング 
				&copy; 1987 
			</div>
		</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write("\<script src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'>\<\/script>" );
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-3244420-1");
pageTracker._initData();
pageTracker._trackPageview();
</script>
	</div>
</body>

</html>